"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./runtime-dom.esm-bundler-DDEFqnaf.cjs"),g=require("content-engine-lib"),S={class:"min-h-screen font-sans transition-colors duration-300 bg-gray-100 text-gray-900 dark:bg-[#0b1220] dark:text-gray-100 relative"},I={class:"pt-24 pb-28 px-6"},D={class:"max-w-4xl mx-auto"},T={class:"mb-6 text-2xl font-bold tracking-tight text-gray-900 dark:text-gray-100"},j=["innerHTML"],z={key:1,class:"flex justify-center py-20"},O={class:"fixed bottom-0 left-0 right-0 h-20 px-8 flex items-center justify-end gap-4 border-t backdrop-blur-md bg-white/90 border-gray-200 dark:bg-[#0f172a]/90 dark:border-gray-700 z-40"},U={class:"w-auto"},L=["disabled"],q={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},M={key:0,class:"fixed top-24 right-6 z-[100] max-w-sm w-full pointer-events-auto"},J={class:"p-4"},F={class:"flex items-start"},A={class:"flex-shrink-0"},P={key:0},R={key:1},G={class:"ml-3 flex-1"},X={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},Z={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Y=e.defineComponent({__name:"index",props:{_p:{},_$p:{}},setup(r){const c=e.ref(""),_=e.ref(null),l=e.ref(!1);e.ref(!1);const b=e.ref("admin_1"),y=e.ref(r._$p?.data?.curr.data.theme||"light"),i=e.ref({s_param:Object.fromEntries(new URLSearchParams(window.location.search||{}))});i.value.s_param?.mode||(i.value.s_param.mode="create"),i.value.s_param.mode=="update"&&!i.value.s_param.coupon_id&&(i.value.s_param.mode="create");const s=e.reactive({show:!1,type:"success",title:"",message:""}),f=(t,a,p)=>{s.type=t,s.title=a,s.message=p,s.show=!0,setTimeout(()=>{s.show=!1},3500)},v=t=>{t==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};e.watch(y,t=>{v(t),o.l[0]&&o.l[0].data&&(o.l[0].data.theme=t)});const B={section:"Basic Details",name:"coupon_id",label:"Coupon ID (Required)",type:"text",placeholder:"Enter ID to update",validation:"required|min:1",columns:12,value:i.value.s_param.coupon_id},h=[{section:"Basic Details",name:"code",label:"Coupon Code",type:"text",placeholder:"SAVE20",validation:"required|length:3,20",columns:6},{name:"description",label:"Description",type:"textarea",validation:"required|length:10,200",columns:6,rows:3},{section:"Discount",name:"discount_type",label:"Type",type:"radio",columns:6,validation:"required",options:[{label:"% Percentage",value:"percentage"},{label:"₹ Flat Amount",value:"flat"}]},{name:"discount_value",label:"Value",type:"number",validation:"required|min:1",columns:6},{section:"Limits",name:"min_order_value",label:"Minimum Order (₹)",type:"number",validation:"required|min:0",columns:4},{name:"max_discount",label:"Maximum Discount (₹)",type:"number",validation:"min:0",columns:4},{name:"valid_days",label:"Validity (Days)",type:"number",validation:"required|min:1",columns:4},{section:"Usage",name:"max_usage_per_user",label:"Usage Per User",type:"number",validation:"required|min:1",columns:6},{name:"total_usage_limit",label:"Total Usage Limit",type:"number",validation:"required|min:1",columns:6}],k=t=>t==="update"?[B,...h]:[...h],o=e.reactive({l:[{id:"coupon-form",type:"form",slug:"coupon",data:{mode:i.value.s_param?.mode,defaults:{code:"",discount:"",expiry:""},actions:{back:!1,submit:!1},fields:[...h],ui:{title_create:"Create New Coupon",title_update:"Update Coupon",submit_create:"Submit",submit_update:"Submit",submit_position:"none"},env:"prod",theme:"auto"}}]}),d=e.ref(o.l[0].data.mode);let m;e.watch(()=>o.l[0].data.mode,async t=>{d.value=t,o.l[0].data.fields=k(t),m&&await m()},{immediate:!0}),e.onMounted(async()=>{r._p.my.emitter=r._p.f.new_emitter(),v(y.value);const t={lib:[],lazy_lib:{renderer_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/renderer.es.js",hydrator_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/hydrator.es.js",editor_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/editor.es.js"}};try{const a=await g.ce_renderer(t),p=await g.ce_hydrator(t);g.ce_listen("msg",async n=>{if(n.type==="form_submit"){const u=n.custom?.payload;u&&await V(u)}}),m=async()=>{const n=JSON.parse(JSON.stringify(o)),u=await a.set({data:n});if(u?.r){if(c.value=u.r,u.style){const w=document.createElement("style");w.innerHTML=u.style,document.head.appendChild(w)}await e.nextTick(),await p.set({data:n})}},o.l[0].data.fields=k(o.l[0].data.mode),await m()}catch(a){console.error("Error initializing form:",a)}});const C=()=>{if(!_.value)return;const t=_.value.querySelector("form");t&&t.requestSubmit()},V=async t=>{l.value=!0;const a={user_id:b.value,code:t.code,description:t.description,coupon_type:"cart_level",discount_type:t.discount_type,discount_value:Number(t.discount_value),max_discount:Number(t.max_discount||0),min_order_value:Number(t.min_order_value||0),max_usage_per_user:Number(t.max_usage_per_user||1),total_usage_limit:Number(t.total_usage_limit||1),valid_days:Number(t.valid_days||1),where:{id:"",brand:"",category:[]}};d.value==="create"?a.operation="create_coupon":(a.operation="update_coupon",t.coupon_id?a.coupon_id=Number(t.coupon_id):o.l[0].data.defaults.coupon_id&&(a.coupon_id=Number(o.l[0].data.defaults.coupon_id)),a.is_active=!0),console.log("Sending Payload:",a);try{const n=await(await fetch("https://fastapi.dryutil.1mn.io/client/api/i/ona/order_management",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImYwZTNlMDRiLTVkNDAtNDg1ZS05OGU4LWEzOTI3NWU3MzM0OCIsInNlY3VyaXR5Ijp7InBhcnR5IjpbInBhcnR5XzEiLCJwYXJ0eV8yIl19LCJzdWIiOiJmMGUzZTA0Yi01ZDQwLTQ4NWUtOThlOC1hMzkyNzVlNzMzNDgiLCJpYXQiOjE3NjU4MTI4Mjh9.OoClnPtlxI71L-e555nbNSmenmGufxewp78SlmdZCNxeuauXao5RRvqwOKQ77SJFqJXk0ng6GZ7VOgYECdEf-3k1UGX7w1NE_D5A6SP3UkVsSG8orYACFuvTyesbFwkpnEhdu0PBd6n8wuLkgU6nZ1bLDzKVg1zd8fFeJrwmUqk"},body:JSON.stringify(a)})).json();n.success||n.status==="success"||n.code===200?(f("success","Operation Successful","Coupon saved successfully."),d.value==="create"&&x()):f("error","Action Failed",n.message||"Validation failed.")}catch(p){f("error","Network Error","Check console for details."),console.error(p)}finally{l.value=!1}},x=async()=>{o.l[0].data.mode="create",o.l[0].data.defaults={code:"",description:"",discount_value:"",min_order_value:"",max_discount:"",valid_days:"",max_usage_per_user:"",total_usage_limit:"",discount_type:""},m&&await m()},E=()=>{g.ce_call("msg",{type:"navigate_back",_p:r._p,_$p:r._$p})};return(t,a)=>(e.openBlock(),e.createElementBlock("div",S,[e.createBaseVNode("header",{class:"fixed top-0 left-0 right-0 z-50 h-16 px-6 flex items-center justify-between border-b backdrop-blur-md bg-white/80 border-gray-200 dark:bg-[#0f172a]/90 dark:border-gray-700"},[e.createBaseVNode("button",{onClick:E,class:"flex items-center gap-2 px-4 py-2 rounded-lg border bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:hover:bg-gray-600"}," ← Back ")]),e.createBaseVNode("main",I,[e.createBaseVNode("div",D,[e.createBaseVNode("h1",T,e.toDisplayString(d.value==="create"?"Create New Coupon":"Update Existing Coupon"),1),c.value?(e.openBlock(),e.createElementBlock("div",{key:d.value,ref_key:"formContainer",ref:_,innerHTML:c.value,class:"rounded-xl border shadow-xl overflow-hidden bg-white border-gray-200 dark:bg-[#020617] dark:border-gray-700"},null,8,j)):(e.openBlock(),e.createElementBlock("div",z,[...a[0]||(a[0]=[e.createBaseVNode("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])]))])]),e.createBaseVNode("footer",O,[d.value==="update"?(e.openBlock(),e.createElementBlock("button",{key:0,onClick:x,class:"px-6 py-2.5 rounded-lg font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition"}," Cancel Update ")):e.createCommentVNode("",!0),e.createBaseVNode("div",U,[e.createBaseVNode("button",{onClick:C,disabled:l.value,class:e.normalizeClass(["px-8 py-2.5 rounded-lg font-semibold text-white shadow-lg transition active:scale-95 flex items-center justify-center gap-2",[l.value?"opacity-75 cursor-not-allowed":"",d.value==="create"?"bg-emerald-600 hover:bg-emerald-700":"bg-blue-600 hover:bg-blue-700"]])},[l.value?(e.openBlock(),e.createElementBlock("span",q)):e.createCommentVNode("",!0),e.createBaseVNode("span",null,e.toDisplayString(l.value?"Processing...":d.value==="create"?"Generate Coupon":"Save Changes"),1)],10,L)])]),e.createVNode(e.Transition,{"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:e.withCtx(()=>[s.show?(e.openBlock(),e.createElementBlock("div",M,[e.createBaseVNode("div",{class:e.normalizeClass(["rounded-lg overflow-hidden toast-card",s.type==="success"?"toast-success":"toast-error"])},[e.createBaseVNode("div",J,[e.createBaseVNode("div",F,[e.createBaseVNode("div",A,[s.type==="success"?(e.openBlock(),e.createElementBlock("span",P,"✅")):(e.openBlock(),e.createElementBlock("span",R,"⚠️"))]),e.createBaseVNode("div",G,[e.createBaseVNode("p",X,e.toDisplayString(s.title),1),e.createBaseVNode("p",Z,e.toDisplayString(s.message),1)])])])],2)])):e.createCommentVNode("",!0)]),_:1})]))}}),N=async r=>({set:async c=>{console.log(`--hydrator [${c.data.curr.type}]`);const _={_p:r,_$p:c},l=e.createApp(Y,_),b={r:"",style:"",evt:{change:()=>{r.f.call("msg",{type:"change",_p:r,_$p:c,custom:{}})}}},y=document.getElementById(r.f.name("vue-root"));return l.mount(y),b}});exports.hydrator=N;exports.index=N;
