"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("./runtime-dom.esm-bundler-DDEFqnaf.cjs"),N=()=>({set:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const a=Math.random()*16|0;return(e=="x"?a:a&3|8).toString(16)})}),z=async()=>({f:{name:e=>`${e.name}${e.id}`}}),E=async()=>({set:async e=>{console.log("--theme");try{if(!e.el_id)throw new Error("[el_id] is required");const a=e.name,r=document.getElementById(e.el_id);if(!r)throw new Error("[el_id] is invalid");(i=>{const c=s=>{(d=>{const n=d.getAttribute("data-ce");if(!n)return;const u=JSON.parse(n).filter(l=>l?.k.startsWith("t-"));if(u.length!=0)for(const l of u){const f=l.k,h=l.v.split(" ");if(f==`t-${a}-class`)for(const g of h)d.classList.add(g);else for(const g of h)d.classList.remove(g)}})(s)};for(const s of i.getElementsByTagName("*"))c(s);c(i)})(r)}catch(a){const r=`err: [theme] ${a}`;throw console.log(r),r}}});function B(e,a=1e3){let r={cnt:0};return new Promise(i=>{const c=()=>{console.log(`[setInterval] is running.. [count=${r.cnt}]`);try{e()&&(clearInterval(s),i())}catch{console.log(`warn: [wait_until] ignoring the exception in setInterval and will check again after [interval=${a}]`)}r.cnt+=1},s=setInterval(()=>{c()},a);c()})}let L=class{listeners={};on=(e,a)=>((this.listeners[e]||=[]).push(a),()=>this.off(e,a));off=(e,a)=>{this.listeners[e]=this.listeners[e]?.filter(r=>r!==a)};emit=async(e,...a)=>{for(const r of this.listeners[e]??[])await r(...a)};emitParallel=async(e,...a)=>{await Promise.all((this.listeners[e]??[]).map(r=>r(...a)))};emitSafe=async(e,...a)=>{for(const r of this.listeners[e]??[])try{await r(...a)}catch(i){this.listeners.error?.forEach(c=>c(i))}}};const k=()=>new L;class V{startTime;endTime;isRunning;constructor(){this.startTime=0,this.endTime=0,this.isRunning=!1}start(){if(this.isRunning)throw new Error("Benchmark has already started.");this.startTime=performance.now(),this.isRunning=!0}stop(){if(!this.isRunning)throw new Error("Benchmark hasn't started.");this.endTime=performance.now(),this.isRunning=!1}result(){if(this.isRunning)throw new Error("Benchmark is still running.");return{time_taken_ms:(this.endTime-this.startTime).toFixed(4)}}}console.log("content-engine-lib");let y={lib:{inbuilt_lib:[],l:{},set:async e=>{const a=e?.lib||[];for(const[r,i]of a.entries()){const c=i,s=`${c.name}:${e.run_from}`,d=`${e.run_from}_src`;let n=c[d];const u=`${e.run_from}_src`;let l=e?.lazy_lib?.[u]||null;if(l&&(l=l.replace("{*}",`${c.name}`)),console.log(`_lazy_src: ${l}`),console.log(`_src: ${n}`),y.lib.l.hasOwnProperty(`${s}`)==!1){if(/^[a-zA-Z0-9]/.test(n)&&n.includes("/")==!1&&y.lib.inbuilt_lib.indexOf(`${c.name}`)===-1)if(l)n=l;else throw`[lib-name=${c.name},lib-src=${n}] not allowed or available in in-build mode. Need to use lazy-lib config.`;if(n.startsWith("./")||n.startsWith("../")){const f=await import(`${n}`);y.lib.l[`${s}`]={lib:f,src:n}}if(n.startsWith("http://")||n.startsWith("https://")){const f=await import(`${n}`);y.lib.l[`${s}`]={lib:f,src:n}}}}console.log(await y.lib.get_all({}))},get:async e=>{let a=null;const r=`${e.name}:${e.run_from}`;return y.lib.l.hasOwnProperty(`${r}`)==!1&&await y.lib.set({lib:[{renderer_src:e.name,hydrator_src:e.name,editor_src:e.name,name:e.name}],run_from:e.run_from,lazy_lib:e.lazy_lib}),a=y.lib.l[`${r}`],a},get_all:async e=>y.lib.l},path:{set:e=>{let a="",r="";const i=e.src.split("/");if(e.src.indexOf("://localhost")!==-1||e.src.indexOf("://127.0.0.1")!==-1||(r="/dist"),i.indexOf(e.type)!==-1)for(const[c,s]of i.entries()){let d=c==0?"":"/";if(a+=`${d}${s}`,s==e.type)return`${a}${r}${e.name}`}else for(const[c,s]of i.entries()){let d=c==0?"":"/";if(a+=`${d}${s}`,s=="src")return`${a}${r}${e.name}`}return`${a}${r}${e.name}`}}};const S=k(),T=k(),U=S.on,M=S.emit,q=T.emit,R=T.on,J=async e=>{const a=await z();return await y.lib.set({lib:e.lib,run_from:"renderer",lazy_lib:e.lazy_lib}),{set:async r=>{console.log("--renderer [set]"),r.return=r?.return||{},r.return.r=r?.return?.r||"full";const i=new V;i.start();let c=r.data?.value?.l||r.data.l,s={r:null,style:"",head:"",benchmark:null};return r.return.r=="full"?s.r="":s.r=[],await(async()=>{for(const d of c){const n=await await y.lib.get({name:d.type,run_from:"renderer",lazy_lib:e.lazy_lib}),u=await(await n.lib.index({f:{name:l=>a.f.name({id:d.id,name:l}),get_lib:async l=>await await y.lib.get({name:l.name,run_from:l.run_from,lazy_lib:e.lazy_lib}),set_theme:async l=>await(await E()).set(l),path:l=>y.path.set({src:n.src,type:d.type,name:l}),uuid:()=>N().set(),wait_until:B}})).set({data:{curr:d}});r?.return?.r=="full"?s.r+=u?.r||"":s.r.push(u?.r||""),s.style+=u?.style||"",s.head+=u?.head||""}})(),i.stop(),s.benchmark=i.result(),s}}},P=async e=>{const a=await z();return await y.lib.set({lib:e.lib,run_from:"hydrator",lazy_lib:e.lazy_lib}),{set:async r=>{console.log("--hydrator [set]");const i=new V;i.start();let c={r:"",style:""},s={style_id:`${N().set()}_stl`},d=r.data?.value?.l||r.data.l;const n=async()=>{for(const u of d){const l=await await y.lib.get({name:u.type,run_from:"hydrator",lazy_lib:e.lazy_lib}),f=l.lib,h=k(),g=h.on,_=await(await f.index({my:{},f:{name:m=>a.f.name({id:u.id,name:m}),get_lib:async m=>await await y.lib.get({name:m.name,run_from:m.run_from,lazy_lib:e.lazy_lib}),set_theme:async m=>await(await E()).set(m),path:m=>y.path.set({src:l.src,type:u.type,name:m}),uuid:()=>N().set(),wait_until:B,call:q,listen:g,new_emitter:()=>k()}})).set({data:{curr:u}});U("msg",async m=>{try{if(Object.keys(m.where||{}).length==0){await h.emit("msg",m);return}}catch{}try{if(u?.[m.where?.key||""]==m.where?.value){await h.emit("msg",m);return}}catch{}}),c.style+=_.style}};await B(()=>document.readyState==="complete"||typeof window<"u",50),await n();try{(u=>{const l=document.getElementById(`${s.style_id}`);l&&l.remove();const f=document.createElement("style");f.id=`${s.style_id}`,f.innerHTML=`${c.style}`,u.appendChild(f)})(document.head)}catch(u){console.log(`${u}, Failed to set style..`)}return i.stop(),{benchmark:i.result()}}}},F={class:"min-h-screen font-sans transition-colors duration-300 bg-gray-100 text-gray-900 dark:bg-[#0b1220] dark:text-gray-100 relative"},A={class:"pt-24 pb-28 px-6"},W={class:"max-w-4xl mx-auto"},Z={class:"mb-6 text-2xl font-bold tracking-tight text-gray-900 dark:text-gray-100"},G=["innerHTML"],X={key:1,class:"flex justify-center py-20"},Y={class:"fixed bottom-0 left-0 right-0 h-20 px-8 flex items-center justify-end gap-4 border-t backdrop-blur-md bg-white/90 border-gray-200 dark:bg-[#0f172a]/90 dark:border-gray-700 z-40"},H={class:"w-auto"},Q=["disabled"],K={key:0,class:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"},ee={key:0,class:"fixed top-24 right-6 z-[100] max-w-sm w-full pointer-events-auto"},te={class:"p-4"},ae={class:"flex items-start"},re={class:"flex-shrink-0"},se={key:0},ne={key:1},oe={class:"ml-3 flex-1"},ie={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},le={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},ce=t.defineComponent({__name:"index",props:{_p:{},_$p:{}},setup(e){const a=t.ref(""),r=t.ref(null),i=t.ref(!1);t.ref(!1);const c=t.ref("admin_1"),s=t.ref(e._$p?.data?.curr.data.theme||"light"),d=t.ref({s_param:Object.fromEntries(new URLSearchParams(window.location.search||{}))});d.value.s_param?.mode||(d.value.s_param.mode="create"),d.value.s_param.mode=="update"&&!d.value.s_param.coupon_id&&(d.value.s_param.mode="create");const n=t.reactive({show:!1,type:"success",title:"",message:""}),u=(o,p,v)=>{n.type=o,n.title=p,n.message=v,n.show=!0,setTimeout(()=>{n.show=!1},3500)},l=o=>{o==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};t.watch(s,o=>{l(o),_.l[0]&&_.l[0].data&&(_.l[0].data.theme=o)});const f={section:"Basic Details",name:"coupon_id",label:"Coupon ID (Required)",type:"text",placeholder:"Enter ID to update",validation:"required|min:1",columns:12,value:d.value.s_param.coupon_id},h=[{section:"Basic Details",name:"code",label:"Coupon Code",type:"text",placeholder:"SAVE20",validation:"required|length:3,20",columns:6},{name:"description",label:"Description",type:"textarea",validation:"required|length:10,200",columns:6,rows:3},{section:"Discount",name:"discount_type",label:"Type",type:"radio",columns:6,validation:"required",options:[{label:"% Percentage",value:"percentage"},{label:"₹ Flat Amount",value:"flat"}]},{name:"discount_value",label:"Value",type:"number",validation:"required|min:1",columns:6},{section:"Limits",name:"min_order_value",label:"Minimum Order (₹)",type:"number",validation:"required|min:0",columns:4},{name:"max_discount",label:"Maximum Discount (₹)",type:"number",validation:"min:0",columns:4},{name:"valid_days",label:"Validity (Days)",type:"number",validation:"required|min:1",columns:4},{section:"Usage",name:"max_usage_per_user",label:"Usage Per User",type:"number",validation:"required|min:1",columns:6},{name:"total_usage_limit",label:"Total Usage Limit",type:"number",validation:"required|min:1",columns:6}],g=o=>o==="update"?[f,...h]:[...h],_=t.reactive({l:[{id:"coupon-form",type:"form",slug:"coupon",data:{mode:d.value.s_param?.mode,defaults:{code:"",discount:"",expiry:""},actions:{back:!1,submit:!1},fields:[...h],ui:{title_create:"Create New Coupon",title_update:"Update Coupon",submit_create:"Submit",submit_update:"Submit",submit_position:"none"},env:"prod",theme:"auto"}}]}),m=t.ref(_.l[0].data.mode);let x;t.watch(()=>_.l[0].data.mode,async o=>{m.value=o,_.l[0].data.fields=g(o),x&&await x()},{immediate:!0}),t.onMounted(async()=>{e._p.my.emitter=e._p.f.new_emitter(),l(s.value);const o={lib:[],lazy_lib:{renderer_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/renderer.es.js",hydrator_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/hydrator.es.js",editor_src:"https://cdn.jsdelivr.net/gh/1mn-io/mn-app/modules/{*}/dist/editor.es.js"}};try{const p=await J(o),v=await P(o);R("msg",async b=>{if(b.type==="form_submit"){const w=b.custom?.payload;w&&await j(w)}}),x=async()=>{const b=JSON.parse(JSON.stringify(_)),w=await p.set({data:b});if(w?.r){if(a.value=w.r,w.style){const C=document.createElement("style");C.innerHTML=w.style,document.head.appendChild(C)}await t.nextTick(),await v.set({data:b})}},_.l[0].data.fields=g(_.l[0].data.mode),await x()}catch(p){console.error("Error initializing form:",p)}});const O=()=>{if(!r.value)return;const o=r.value.querySelector("form");o&&o.requestSubmit()},j=async o=>{i.value=!0;const p={user_id:c.value,code:o.code,description:o.description,coupon_type:"cart_level",discount_type:o.discount_type,discount_value:Number(o.discount_value),max_discount:Number(o.max_discount||0),min_order_value:Number(o.min_order_value||0),max_usage_per_user:Number(o.max_usage_per_user||1),total_usage_limit:Number(o.total_usage_limit||1),valid_days:Number(o.valid_days||1),where:{id:"",brand:"",category:[]}};m.value==="create"?p.operation="create_coupon":(p.operation="update_coupon",o.coupon_id?p.coupon_id=Number(o.coupon_id):_.l[0].data.defaults.coupon_id&&(p.coupon_id=Number(_.l[0].data.defaults.coupon_id)),p.is_active=!0),console.log("Sending Payload:",p);try{const b=await(await fetch("https://fastapi.dryutil.1mn.io/client/api/i/ona/order_management",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImYwZTNlMDRiLTVkNDAtNDg1ZS05OGU4LWEzOTI3NWU3MzM0OCIsInNlY3VyaXR5Ijp7InBhcnR5IjpbInBhcnR5XzEiLCJwYXJ0eV8yIl19LCJzdWIiOiJmMGUzZTA0Yi01ZDQwLTQ4NWUtOThlOC1hMzkyNzVlNzMzNDgiLCJpYXQiOjE3NjU4MTI4Mjh9.OoClnPtlxI71L-e555nbNSmenmGufxewp78SlmdZCNxeuauXao5RRvqwOKQ77SJFqJXk0ng6GZ7VOgYECdEf-3k1UGX7w1NE_D5A6SP3UkVsSG8orYACFuvTyesbFwkpnEhdu0PBd6n8wuLkgU6nZ1bLDzKVg1zd8fFeJrwmUqk"},body:JSON.stringify(p)})).json();b.success||b.status==="success"||b.code===200?(u("success","Operation Successful","Coupon saved successfully."),m.value==="create"&&$()):u("error","Action Failed",b.message||"Validation failed.")}catch(v){u("error","Network Error","Check console for details."),console.error(v)}finally{i.value=!1}},$=async()=>{_.l[0].data.mode="create",_.l[0].data.defaults={code:"",description:"",discount_value:"",min_order_value:"",max_discount:"",valid_days:"",max_usage_per_user:"",total_usage_limit:"",discount_type:""},x&&await x()},D=()=>{M("msg",{type:"navigate_back",_p:e._p,_$p:e._$p})};return(o,p)=>(t.openBlock(),t.createElementBlock("div",F,[t.createBaseVNode("header",{class:"fixed top-0 left-0 right-0 z-50 h-16 px-6 flex items-center justify-between border-b backdrop-blur-md bg-white/80 border-gray-200 dark:bg-[#0f172a]/90 dark:border-gray-700"},[t.createBaseVNode("button",{onClick:D,class:"flex items-center gap-2 px-4 py-2 rounded-lg border bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600 dark:hover:bg-gray-600"}," ← Back ")]),t.createBaseVNode("main",A,[t.createBaseVNode("div",W,[t.createBaseVNode("h1",Z,t.toDisplayString(m.value==="create"?"Create New Coupon":"Update Existing Coupon"),1),a.value?(t.openBlock(),t.createElementBlock("div",{key:m.value,ref_key:"formContainer",ref:r,innerHTML:a.value,class:"rounded-xl border shadow-xl overflow-hidden bg-white border-gray-200 dark:bg-[#020617] dark:border-gray-700"},null,8,G)):(t.openBlock(),t.createElementBlock("div",X,[...p[0]||(p[0]=[t.createBaseVNode("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])]))])]),t.createBaseVNode("footer",Y,[m.value==="update"?(t.openBlock(),t.createElementBlock("button",{key:0,onClick:$,class:"px-6 py-2.5 rounded-lg font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition"}," Cancel Update ")):t.createCommentVNode("",!0),t.createBaseVNode("div",H,[t.createBaseVNode("button",{onClick:O,disabled:i.value,class:t.normalizeClass(["px-8 py-2.5 rounded-lg font-semibold text-white shadow-lg transition active:scale-95 flex items-center justify-center gap-2",[i.value?"opacity-75 cursor-not-allowed":"",m.value==="create"?"bg-emerald-600 hover:bg-emerald-700":"bg-blue-600 hover:bg-blue-700"]])},[i.value?(t.openBlock(),t.createElementBlock("span",K)):t.createCommentVNode("",!0),t.createBaseVNode("span",null,t.toDisplayString(i.value?"Processing...":m.value==="create"?"Generate Coupon":"Save Changes"),1)],10,Q)])]),t.createVNode(t.Transition,{"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:t.withCtx(()=>[n.show?(t.openBlock(),t.createElementBlock("div",ee,[t.createBaseVNode("div",{class:t.normalizeClass(["rounded-lg overflow-hidden toast-card",n.type==="success"?"toast-success":"toast-error"])},[t.createBaseVNode("div",te,[t.createBaseVNode("div",ae,[t.createBaseVNode("div",re,[n.type==="success"?(t.openBlock(),t.createElementBlock("span",se,"✅")):(t.openBlock(),t.createElementBlock("span",ne,"⚠️"))]),t.createBaseVNode("div",oe,[t.createBaseVNode("p",ie,t.toDisplayString(n.title),1),t.createBaseVNode("p",le,t.toDisplayString(n.message),1)])])])],2)])):t.createCommentVNode("",!0)]),_:1})]))}}),I=async e=>({set:async a=>{console.log(`--hydrator [${a.data.curr.type}]`);const r={_p:e,_$p:a},i=t.createApp(ce,r),c={r:"",style:"",evt:{change:()=>{e.f.call("msg",{type:"change",_p:e,_$p:a,custom:{}})}}},s=document.getElementById(e.f.name("vue-root"));return i.mount(s),c}});exports.hydrator=I;exports.index=I;
